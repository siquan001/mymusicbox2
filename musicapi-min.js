var musicapi={cl:function(e){var t=new URL(e);return t.protocol="https:",t.host="ws.stream.qqmusic.qq.com",t.href},get:function(e,t){var a,r=0,n={qq:{error:null},kugou:{error:null},netease:{error:null}};e.def=e.def?e.def:{},e.name&&(e.def.title=e.def.title?e.def.title:e.artist+"-"+e.name,e.def.songname=e.def.songname?e.def.songname:e.name,e.def.artist=e.def.artist?e.def.artist:e.artist),e.def.lrcstr&&(e.def.lrc=this.parseLrc(e.def.lrcstr));var i={qq:[e.qq&&e.qq.mid,function(){a=musicapi._qq(e.qq.mid,(function(a){if(a.error)return n.qq=a,r++,void s();t(musicapi._compareDef(a,e.def))}))}],netease:[e.netease&&e.netease.id,function(){a=musicapi._netease(e.netease.id,(function(a){if(a.error)return n.netease=a,r++,void s();var i,o,c;i=a.url,o=function(i){i?t(musicapi._compareDef(a,e.def)):(n.netease=a,r++,s())},(c=document.createElement("audio")).src=i,c.onloadedmetadata=function(){o(!0)},c.onerror=function(){o(!1)}}))}],kugou:[e.kugou&&e.kugou.hash,function(){a=musicapi._kugou(e.kugou.hash,e.kugou.album_id,(function(a){if(a.error||!a.url)return n.kugou=a,r++,void s();t(musicapi._compareDef(a,e.def))}))}],none:[!0,function(){t(0==r?e.def:{error:"QQ:"+n.qq.error+"\nKugou:"+n.kugou.error+"\nNetease:"+n.netease.error,errs:n})}]},o=["netease","qq","kugou"];function s(){for(var e=r;e<3;e++)if(i[o[e]][0]){i[o[e]][1]();break}}return e.firstReq&&-1!=o.indexOf(e.firstReq)&&(o.splice(o.indexOf(e.firstReq),1),o.unshift(e.firstReq)),s(),a},search:function(e,t,a={}){return"object"==typeof a&&a||(a={}),"qq"==a.type?musicapi._qq_search(e,t,a):"netease"==a.type?musicapi._netease_search(e,t,a):musicapi._kugou_search(e,t,a)},_kugou:function(e,t,a){var r="https://api.gumengya.com/Api/KuGou?format=json&id="+e.toUpperCase();return musicapi._request(r,(function(e){200==e.code?a({title:e.data.author+" - "+e.data.title,songname:e.data.title,artist:e.data.author,lrc:musicapi.parseLrc(e.data.lrc),url:e.data.url,album:"",img:e.data.pic.replace("/150",""),lrcstr:e.data.lrc,minipic:e.data.pic}):a({error:"获取歌曲失败",code:e.err_code})}))},_qq:function(e,t){var a,r=0,n={},i=musicapi._request("https://api.gumengya.com/Api/Tencent?format=json&id="+e,(function(o){if(0!=o&&o.data)t({title:o.data.author+" - "+o.data.title,songname:o.data.title,artist:o.data.author,lrc:musicapi.parseLrc(o.data.lrc),url:musicapi.cl(o.data.url),album:"",img:o.data.pic,lrcstr:o.data.lrc});else{i=musicapi._request("https://api.vkeys.cn/v2/music/tencent?quality=8&mid="+e,(function(e){0==e||200!=e.code?(t({error:"获取歌曲失败",code:1e4}),a.abort()):function(e){var a={title:e.data.singer+" - "+e.data.song,songname:e.data.song,artist:e.data.singer,url:musicapi.cl(e.data.url),album:e.data.album,img:e.data.cover};for(var i in a)n[i]=a[i];2==++r&&t(n)}(e)})),a=musicapi._request("https://api.vkeys.cn/v2/music/tencent/lyric?mid="+e,(function(e){clearTimeout(s),0==e||200!=e.code?(n.nolrc=!0,n.lrc={0:"歌词获取失败"},n.lrcstr="[00:00.00] 歌词获取失败"):(n.lrc=musicapi.parseLrc(e.data.lrc),n.lrcstr=e.data.lrc);2==++r&&t(n)}));var s=setTimeout((function(){n(!1)}),5e3)}}));return{abort:function(){i.abort(),a&&a.abort()}}},_netease:function(e,t){var a,r=0,n={},i=musicapi._request("https://api.gumengya.com/Api/Netease?format=json&id="+e,(function(o){if(0!=o&&o.data)t({title:o.data.author+" - "+o.data.title,songname:o.data.title,artist:o.data.author,lrc:musicapi.parseLrc(o.data.lrc),url:o.data.url,album:"",img:o.data.pic,lrcstr:o.data.lrc});else{i=musicapi._request("https://api.vkeys.cn/v2/music/netease?quality=8&id="+e,(function(e){0==e||200!=e.code?(t({error:"获取歌曲失败",code:1e4}),a.abort()):function(e){var a={title:e.data.singer+" - "+e.data.song,songname:e.data.song,artist:e.data.singer,url:e.data.url,album:e.data.album,img:e.data.cover};for(var i in a)n[i]=a[i];2==++r&&t(n)}(e)})),a=musicapi._request("https://api.vkeys.cn/v2/music/netease/lyric?id="+e,(function(e){clearTimeout(s),0==e||200!=e.code?(n.nolrc=!0,n.lrc={0:"歌词获取失败"},n.lrcstr="[00:00.00] 歌词获取失败"):(n.lrc=musicapi.parseLrc(e.data.lrc),n.lrcstr=e.data.lrc);2==++r&&t(n)}));var s=setTimeout((function(){n(!1)}),5e3)}}));return{abort:function(){i.abort(),a&&a.abort()}}},_request:function(e,t){var a=new XMLHttpRequest;a.open("GET",e,!0);var r=setTimeout((function(){a.abort(),t(!1)}),5e3);a.onreadystatechange=function(){if(4===a.readyState&&200===a.status){k=a.responseText;try{k=JSON.parse(k)}catch(e){}clearTimeout(r),t(k)}else a.status>400&&(clearTimeout(r),t(!1))},a.onerror=function(){clearTimeout(r),t(!1)};try{a.send()}catch(e){}return{abort:function(){a.abort()}}},_jsonpdl:[],_jsonpsc:null,_jsonp:function(e,t,a,r){var n=Math.random();if(r=a||"callback",this._jsonpdl.push([e,t,a,r,n]),!(this._jsonpdl.length>1))return function e(t,a,r,n){var i=document.createElement("script"),o=t+(t.indexOf("?")>=0?"&":"?")+(r||"callback")+"="+n;i.src=o,window[n]=function(){delete window[n],a.apply(null,arguments),musicapi._jsonpdl.shift(),musicapi._jsonpdl.length>0&&e.apply(null,musicapi._jsonpdl[0])},document.body.appendChild(i),i.onload=function(){document.body.removeChild(i)},i.onerror=function(){a(!1),document.body.removeChild(i)},musicapi._jsonpsc=i}(e,t,a,r),{abort:function(){if(musicapi._jsonpdl[0]==n)try{delete window[r];var e=musicapi._jsonpsc;e.remove(),e=null}catch(e){}else for(var t=0;t<musicapi._jsonpdl.length;t++)musicapi._jsonpdl[t][4]==n&&musicapi._jsonpdl.splice(t,1)}}},_kugou_search:function(e,t,a){var r="https://mobiles.kugou.com/api/v3/search/song?format=jsonp&keyword="+encodeURI(e)+"&page="+(a.page||1)+"&pagesize="+(a.pagesize||30)+"&showtype=1";return musicapi._jsonp(r,(function(e){var r={total:e.data.total,page:a.page||1,songs:[]};e.data.info.forEach((function(e){var t={name:e.songname,artist:e.singername,kugou:{hash:e.hash,album_id:e.album_id,ispriviage:e.privilege>=10}};if(e.filename.match(/【歌词 : .*】/)){var a=e.filename.match(/【歌词 : .*】/);t.title=e.filename.replace(a[0],""),t.matchLyric=a[0].replace("【歌词 : ","").replace("】","")}else t.title=e.filename;r.songs.push(t)})),t(r)}))},_qq_search:function(e,t,a){var r="https://api.vkeys.cn/v2/music/tencent?word="+encodeURIComponent(e)+"&num="+(a.pagesize||30)+"&page="+(a.page||1);return musicapi._request(r,(function(e){var r={total:1/0,page:a.page||1,songs:[]};e.data.forEach((function(e){var t={name:e.song,artist:e.singer,qq:{mid:e.mid}};t.title=e.singer+" - "+e.song,r.songs.push(t)})),t(r)}))},_netease_search:function(e,t,a){var r="https://api.gumengya.com/Api/Music?format=json&site=netease&text="+encodeURIComponent(e)+"&num="+(a.pagesize||30)+"&page="+(a.page||1);return musicapi._request(r,(function(e){var r={total:1/0,page:a.page||1,songs:[]};e.data.forEach((function(e){var t={name:e.title,artist:e.author,netease:{id:e.songid}};t.title=e.author+" - "+e.title,r.songs.push(t)})),t(r)}))},parseLrc:function(e){var t=[];if(0!=(e=e||"[00:00.00] 暂无歌词").length){var a=e.split("\n");for(var r in a){a[r]=a[r].replace(/(^\s*)|(\s*$)/g,"");var n=a[r].substring(a[r].indexOf("[")+1,a[r].indexOf("]")).split(":");if(!isNaN(parseInt(n[0]))){var i=a[r].match(/\[(\d+:.+?)\]/g),o=0;for(var s in i)o+=i[s].length;var c=a[r].substring(o);for(var s in i){n=i[s].substring(1,i[s].length-1).split(":");t.push({t:(60*parseFloat(n[0])+parseFloat(n[1])).toFixed(3),c:c})}}}t.sort((function(e,t){return e.t-t.t}));var u={};return t.forEach((function(e){u[e.t]=e.c})),u}},_compareDef:function(e,t){if(!t)return e;for(var a in t)e[a]=t[a];return e}};