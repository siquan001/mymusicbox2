var musicapi={cl:function(a){var t=new URL(a);return t.protocol="https:",t.host="ws.stream.qqmusic.qq.com",t.href},get:function(a,t){var e,r=0,i={qq:{error:null},kugou:{error:null},netease:{error:null}};return a.def=a.def?a.def:{},a.name&&(a.def.title=a.def.title?a.def.title:a.artist+"-"+a.name,a.def.songname=a.def.songname?a.def.songname:a.name,a.def.artist=a.def.artist?a.def.artist:a.artist),a.def.lrcstr&&(a.def.lrc=this.parseLrc(a.def.lrcstr)),function n(){a.kugou&&a.kugou.hash&&r<1?e=musicapi._kugou(a.kugou.hash,a.kugou.album_id,(function(e){if(e.error||!e.url)return i.kugou=e,r++,void n();t(musicapi._compareDef(e,a.def))})):a.netease&&a.netease.id&&r<2?e=musicapi._netease(a.netease.id,(function(e){if(e.error)return i.netease=e,r++,void n();var o,s,u;o=e.url,s=function(o){o?t(musicapi._compareDef(e,a.def)):(i.netease=e,r++,n())},(u=document.createElement("audio")).src=o,u.onloadedmetadata=function(){s(!0)},u.onerror=function(){s(!1)}})):a.qq&&a.qq.mid&&r<3?e=musicapi._qq(a.qq.mid,(function(e){if(e.error)return i.qq=e,r++,void n();t(musicapi._compareDef(e,a.def))})):t(0==r?a.def:{error:"QQ:"+i.qq.error+"\nKugou:"+i.kugou.error+"\nNetease:"+i.netease.error,errs:i})}(),e},search:function(a,t,e={}){return"object"==typeof e&&e||(e={}),"qq"==e.type?musicapi._qq_search(a,t,e):"netease"==e.type?musicapi._netease_search(a,t,e):musicapi._kugou_search(a,t,e)},_kugou:function(a,t,e){var r="https://api.gumengya.com/Api/KuGou?format=json&id="+a.toUpperCase();return musicapi._request(r,(function(a){200==a.code?e({title:a.data.author+" - "+a.data.title,songname:a.data.title,artist:a.data.author,lrc:musicapi.parseLrc(a.data.lrc),url:a.data.url,album:"",img:a.data.pic.replace("/150",""),lrcstr:a.data.lrc,minipic:a.data.pic}):e({error:"获取歌曲失败",code:a.err_code})}))},_qq:function(a,t){var e,r=0,i={},n=musicapi._request("https://api.gumengya.com/Api/Tencent?format=json&id="+a,(function(o){if(0!=o&&o.data)t({title:o.data.author+" - "+o.data.title,songname:o.data.title,artist:o.data.author,lrc:musicapi.parseLrc(o.data.lrc),url:musicapi.cl(o.data.url),album:"",img:o.data.pic,lrcstr:o.data.lrc});else{function s(a){var e={title:a.data.singer+" - "+a.data.song,songname:a.data.song,artist:a.data.singer,url:musicapi.cl(a.data.url),album:a.data.album,img:a.data.cover};for(var n in e)i[n]=e[n];2==++r&&t(i)}n=musicapi._request("https://api.lolimi.cn/API/yiny/?q=8&mid="+a,(function(r){0==r||200!=r.code?n=musicapi._request("https://siquan-api.wdnmd.top/api/QQMusic?mid="+a,(function(a){0==a||200!=a.code?(t({error:"获取歌曲失败",code:1e4}),e.abort()):s(a)})):s(r)})),e=musicapi._request("https://siquan-api.wdnmd.top/api/QQMusic?type=lyrics&mid="+a,(function(a){0==a||200!=a.code?(i.nolrc=!0,i.lrc={0:"歌词获取失败"},i.lrcstr="[00:00.00] 歌词获取失败"):(i.lrc=musicapi.parseLrc(a.data),i.lrcstr=a.data),2==++r&&t(i)}))}}));return{abort:function(){n.abort(),e&&e.abort()}}},_netease:function(a,t){var e,r=0,i={},n=musicapi._request("https://api.gumengya.com/Api/Netease?format=json&id="+a,(function(o){0!=o&&o.data?t({title:o.data.author+" - "+o.data.title,songname:o.data.title,artist:o.data.author,lrc:musicapi.parseLrc(o.data.lrc),url:o.data.url.replace("https://","http://"),album:"",img:o.data.pic,lrcstr:o.data.lrc}):(n=musicapi._request("https://api.epdd.cn/V1/Music/Netease?q=4&id="+a,(function(a){if(0==a||200!=a.code)t({error:"获取歌曲失败",code:1e4}),e.abort();else{var n={title:a.data.singer+" - "+a.data.song,songname:a.data.song,artist:a.data.singer,url:a.data.url,album:a.data.album,img:a.data.cover};for(var o in n)i[o]=n[o];2==++r&&t(i)}})),e=musicapi._request("https://api.vkeys.cn/API/Netease_Cloud/Lyric?id="+a,(function(a){0==a||200!=a.code?(i.lrc={0:"歌词获取失败"},i.lrcstr="[00:00.00] 歌词获取失败"):(i.lrc=musicapi.parseLrc(a.data),i.lrcstr=a.data),2==++r&&t(i)})))}));return{abort:function(){n.abort(),e&&e.abort()}}},_request:function(a,t){var e=new XMLHttpRequest;e.open("GET",a,!0);var r=setTimeout((function(){e.abort(),t(!1)}),5e3);e.onreadystatechange=function(){if(4===e.readyState&&200===e.status){k=e.responseText;try{k=JSON.parse(k)}catch(a){}clearTimeout(r),t(k)}else e.status>400&&(clearTimeout(r),t(!1))},e.onerror=function(){clearTimeout(r),t(!1)};try{e.send()}catch(a){}return{abort:function(){e.abort()}}},_jsonp:function(a,t,e){var r=document.createElement("script"),i="jsonp_"+Math.random().toString().replace(".",""),n=a+(a.indexOf("?")>=0?"&":"?")+(e||"callback")+"="+i;return r.src=n,window[i]=function(){delete window[i],t.apply(null,arguments)},document.body.appendChild(r),r.onload=function(){document.body.removeChild(r)},{abort:function(){try{r.remove(),r=null}catch(a){}}}},_kugou_search:function(a,t,e){var r="https://mobiles.kugou.com/api/v3/search/song?format=jsonp&keyword="+encodeURI(a)+"&page="+(e.page||1)+"&pagesize="+(e.pagesize||30)+"&showtype=1";return musicapi._jsonp(r,(function(a){var r={total:a.data.total,page:e.page||1,songs:[]};a.data.info.forEach((function(a){var t={name:a.songname,artist:a.singername,kugou:{hash:a.hash,album_id:a.album_id,ispriviage:a.privilege>=10}};if(a.filename.match(/【歌词 : .*】/)){var e=a.filename.match(/【歌词 : .*】/);t.title=a.filename.replace(e[0],""),t.matchLyric=e[0].replace("【歌词 : ","").replace("】","")}else t.title=a.filename;r.songs.push(t)})),t(r)}))},_qq_search:function(a,t,e){var r="https://api.lolimi.cn/API/yiny/?word="+encodeURIComponent(a)+"&num="+(e.pagesize||30)+"&page="+(e.page||1);return musicapi._request(r,(function(a){var r={total:1/0,page:e.page||1,songs:[]};a.data.forEach((function(a){var t={name:a.song,artist:a.singer,qq:{mid:a.mid}};t.title=a.singer+" - "+a.song,r.songs.push(t)})),t(r)}))},_netease_search:function(a,t,e){var r="https://api.gumengya.com/Api/Music?format=json&site=netease&text="+encodeURIComponent(a)+"&num="+(e.pagesize||30)+"&page="+(e.page||1);return musicapi._request(r,(function(a){var r={total:1/0,page:e.page||1,songs:[]};a.data.forEach((function(a){var t={name:a.title,artist:a.author,netease:{id:a.songid}};t.title=a.author+" - "+a.title,r.songs.push(t)})),t(r)}))},parseLrc:function(a){var t=[];if(0!=a.length){var e=a.split("\n");for(var r in e){e[r]=e[r].replace(/(^\s*)|(\s*$)/g,"");var i=e[r].substring(e[r].indexOf("[")+1,e[r].indexOf("]")).split(":");if(!isNaN(parseInt(i[0]))){var n=e[r].match(/\[(\d+:.+?)\]/g),o=0;for(var s in n)o+=n[s].length;var u=e[r].substring(o);for(var s in n){i=n[s].substring(1,n[s].length-1).split(":");t.push({t:(60*parseFloat(i[0])+parseFloat(i[1])).toFixed(3),c:u})}}}t.sort((function(a,t){return a.t-t.t}));var c={};return t.forEach((function(a){c[a.t]=a.c})),c}},_compareDef:function(a,t){if(!t)return a;for(var e in t)a[e]=t[e];return a}};