var musicapi={cl:function(a){var e=new URL(a);return e.protocol="https:",e.host="ws.stream.qqmusic.qq.com",e.href},get:function(a,e){var t,r=0,n={qq:{error:null},kugou:{error:null},netease:{error:null}};return a.def=a.def?a.def:{},a.name&&(a.def.title=a.def.title?a.def.title:a.artist+"-"+a.name,a.def.songname=a.def.songname?a.def.songname:a.name,a.def.artist=a.def.artist?a.def.artist:a.artist),a.def.lrcstr&&(a.def.lrc=this.parseLrc(a.def.lrcstr)),function i(){a.qq&&a.qq.mid&&r<1?t=musicapi._qq(a.qq.mid,(function(t){if(t.error)return n.qq=t,r++,void i();e(musicapi._compareDef(t,a.def))})):a.netease&&a.netease.id&&r<2?t=musicapi._netease(a.netease.id,(function(t){if(t.error)return n.netease=t,r++,void i();var o,s,c;o=t.url,s=function(o){o?e(musicapi._compareDef(t,a.def)):(n.netease=t,r++,i())},(c=document.createElement("audio")).src=o,c.onloadedmetadata=function(){s(!0)},c.onerror=function(){s(!1)}})):a.kugou&&a.kugou.hash&&r<3?t=musicapi._kugou(a.kugou.hash,a.kugou.album_id,(function(t){if(t.error||!t.url)return n.kugou=t,r++,void i();e(musicapi._compareDef(t,a.def))})):e(0==r?a.def:{error:"QQ:"+n.qq.error+"\nKugou:"+n.kugou.error+"\nNetease:"+n.netease.error,errs:n})}(),t},search:function(a,e,t={}){return"object"==typeof t&&t||(t={}),"qq"==t.type?musicapi._qq_search(a,e,t):"netease"==t.type?musicapi._netease_search(a,e,t):musicapi._kugou_search(a,e,t)},_kugou:function(a,e,t){var r="https://api.gumengya.com/Api/KuGou?format=json&id="+a.toUpperCase();return musicapi._request(r,(function(a){200==a.code?t({title:a.data.author+" - "+a.data.title,songname:a.data.title,artist:a.data.author,lrc:musicapi.parseLrc(a.data.lrc),url:a.data.url,album:"",img:a.data.pic.replace("/150",""),lrcstr:a.data.lrc,minipic:a.data.pic}):t({error:"获取歌曲失败",code:a.err_code})}))},_qq:function(a,e){var t,r=0,n={},i=musicapi._request("https://api.gumengya.com/Api/Tencent?format=json&id="+a,(function(o){if(0!=o&&o.data)e({title:o.data.author+" - "+o.data.title,songname:o.data.title,artist:o.data.author,lrc:musicapi.parseLrc(o.data.lrc),url:musicapi.cl(o.data.url),album:"",img:o.data.pic,lrcstr:o.data.lrc});else{i=musicapi._jsonp("https://api.vkeys.cn/V1/Music/Tencent?q=8&mid="+a+"&method=jsonp",(function(a){0==a||200!=a.code?(e({error:"获取歌曲失败",code:1e4}),t.abort()):function(a){var t={title:a.data.singer+" - "+a.data.song,songname:a.data.song,artist:a.data.singer,url:musicapi.cl(a.data.url),album:a.data.album,img:a.data.cover};for(var i in t)n[i]=t[i];2==++r&&e(n)}(a)})),t=musicapi._jsonp("https://api.vkeys.cn/v1/Music/Tencent/Lyric?mid="+a+"&method=jsonp",(function(a){0==a||200!=a.code?(n.nolrc=!0,n.lrc={0:"歌词获取失败"},n.lrcstr="[00:00.00] 歌词获取失败"):(n.lrc=musicapi.parseLrc(a.data.lrc),n.lrcstr=a.data),2==++r&&e(n)}))}}));return{abort:function(){i.abort(),t&&t.abort()}}},_netease:function(a,e){var t,r={},n=musicapi._request("https://api.gumengya.com/Api/Netease?format=json&id="+a,(function(i){0!=i&&i.data?e({title:i.data.author+" - "+i.data.title,songname:i.data.title,artist:i.data.author,lrc:musicapi.parseLrc(i.data.lrc),url:i.data.url.replace("https://","http://"),album:"",img:i.data.pic,lrcstr:i.data.lrc}):n=musicapi._jsonp("https://api.vkeys.cn/V1/Music/Netease?q=8&id="+a+"&method=jsonp",(function(a){if(0==a||200!=a.code)e({error:"获取歌曲失败",code:1e4}),t.abort();else{a.data.singer,a.data.song,a.data.song,a.data.singer,a.data.url,a.data.album,a.data.cover;e(r)}}))}));return{abort:function(){n.abort()}}},_request:function(a,e){var t=new XMLHttpRequest;t.open("GET",a,!0);var r=setTimeout((function(){t.abort(),e(!1)}),5e3);t.onreadystatechange=function(){if(4===t.readyState&&200===t.status){k=t.responseText;try{k=JSON.parse(k)}catch(a){}clearTimeout(r),e(k)}else t.status>400&&(clearTimeout(r),e(!1))},t.onerror=function(){clearTimeout(r),e(!1)};try{t.send()}catch(a){}return{abort:function(){t.abort()}}},_jsonpdl:[],_jsonpsc:null,_jsonp:function(a,e,t,r){var n=Math.random();if(r=t||"callback",this._jsonpdl.push([a,e,t,r,n]),!(this._jsonpdl.length>1))return function a(e,t,r,n){var i=document.createElement("script"),o=e+(e.indexOf("?")>=0?"&":"?")+(r||"callback")+"="+n;i.src=o,window[n]=function(){delete window[n],t.apply(null,arguments),musicapi._jsonpdl.shift(),musicapi._jsonpdl.length>0&&a.apply(null,musicapi._jsonpdl[0])},document.body.appendChild(i),i.onload=function(){document.body.removeChild(i)},i.onerror=function(){t(!1),document.body.removeChild(i)},musicapi._jsonpsc=i}(a,e,t,r),{abort:function(){if(musicapi._jsonpdl[0][4]==n)try{delete window[r];var a=musicapi._jsonpsc;a.remove(),a=null}catch(a){}else for(var e=0;e<musicapi._jsonpdl.length;e++)musicapi._jsonpdl[e][4]==n&&musicapi._jsonpdl.splice(e,1)}}},_kugou_search:function(a,e,t){var r="https://mobiles.kugou.com/api/v3/search/song?format=jsonp&keyword="+encodeURI(a)+"&page="+(t.page||1)+"&pagesize="+(t.pagesize||30)+"&showtype=1";return musicapi._jsonp(r,(function(a){var r={total:a.data.total,page:t.page||1,songs:[]};a.data.info.forEach((function(a){var e={name:a.songname,artist:a.singername,kugou:{hash:a.hash,album_id:a.album_id,ispriviage:a.privilege>=10}};if(a.filename.match(/【歌词 : .*】/)){var t=a.filename.match(/【歌词 : .*】/);e.title=a.filename.replace(t[0],""),e.matchLyric=t[0].replace("【歌词 : ","").replace("】","")}else e.title=a.filename;r.songs.push(e)})),e(r)}))},_qq_search:function(a,e,t){var r="https://api.lolimi.cn/API/yiny/?word="+encodeURIComponent(a)+"&num="+(t.pagesize||30)+"&page="+(t.page||1);return musicapi._request(r,(function(a){var r={total:1/0,page:t.page||1,songs:[]};a.data.forEach((function(a){var e={name:a.song,artist:a.singer,qq:{mid:a.mid}};e.title=a.singer+" - "+a.song,r.songs.push(e)})),e(r)}))},_netease_search:function(a,e,t){var r="https://api.gumengya.com/Api/Music?format=json&site=netease&text="+encodeURIComponent(a)+"&num="+(t.pagesize||30)+"&page="+(t.page||1);return musicapi._request(r,(function(a){var r={total:1/0,page:t.page||1,songs:[]};a.data.forEach((function(a){var e={name:a.title,artist:a.author,netease:{id:a.songid}};e.title=a.author+" - "+a.title,r.songs.push(e)})),e(r)}))},parseLrc:function(a){var e=[];if(0!=(a=a||"[00:00.00] 纯音乐，请欣赏").length){var t=a.split("\n");for(var r in t){t[r]=t[r].replace(/(^\s*)|(\s*$)/g,"");var n=t[r].substring(t[r].indexOf("[")+1,t[r].indexOf("]")).split(":");if(!isNaN(parseInt(n[0]))){var i=t[r].match(/\[(\d+:.+?)\]/g),o=0;for(var s in i)o+=i[s].length;var c=t[r].substring(o);for(var s in i){n=i[s].substring(1,i[s].length-1).split(":");e.push({t:(60*parseFloat(n[0])+parseFloat(n[1])).toFixed(3),c:c})}}}e.sort((function(a,e){return a.t-e.t}));var u={};return e.forEach((function(a){u[a.t]=a.c})),u}},_compareDef:function(a,e){if(!e)return a;for(var t in e)a[t]=e[t];return a}};