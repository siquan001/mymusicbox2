var MUSICLIST_URL  = './musiclist.json'; //歌单文件
var INFO           = true;               // 显示你的评价 (取决于 INFO_ROOT/[mid].txt)
var TAG            = true;               // 显示歌曲标签 (取决于musiclist[i].tag)
var DEFAULT_MODE   = 'light';            // 默认模式 ，可选 light 亮色,dark 暗色
var INFO_ROOT      = './info/'           // 评价文件夹根目录 (结尾要加“/”)
var AUTOPLAY       = true;               // 自动播放
var START_PLAY     = 'random'            // 刚开始的播放策略，可选 random 随机播放，first 第一首播放
var PLAY_MODE      = 'order';             // 播放模式，可选 loop 单曲循环，random 随机播放，order 顺序播放
var ENABLED_MID    = true;               // 是否启用歌曲mid，这主要应用于歌曲定位和评价显示
var SHOW_MID_IN_URL= true;               // 是否显示歌曲mid在歌曲链接中(这不会导致历史记录堆积)

/* ↑↑↑ 根配置 ↑↑↑ */

!function(){var e=[];musicapi._request(MUSICLIST_URL,(function(t){if("string"==typeof t&&(t=JSON.parse(t)),0==t)alert("歌曲列表获取失败！");else{e=t;var n=document.querySelector(".musiclist ul");e.forEach((function(e,t){var i=document.createElement("li");i.innerHTML='<div class="anim"><div></div><div></div><div></div></div><div class="index"></div><div class="name"></div>',i.querySelector(".name").innerHTML=e.artist+" - "+e.name,i.querySelector(".index").innerHTML=t,i.onclick=function(){r(t)},n.appendChild(i)})),l()}}));var t={0:"歌词加载中"},n={img:document.getElementById("img"),title:document.getElementById("music-title"),album:document.getElementById("music-album"),singer:document.getElementById("music-singer"),audio:document.getElementById("audio"),range:{r1:document.querySelector(".range .r1"),r2:document.querySelector(".range .r2"),r:document.querySelector(".range")},time:{cur:document.querySelector(".time .l"),max:document.querySelector(".time .r")},playbtn:document.querySelector(".playbtn"),container:document.querySelector(".siquan-player .container"),lrc:document.querySelector(".right ul"),lastbtn:document.querySelector(".lastbtn"),nextbtn:document.querySelector(".nextbtn"),sx:document.querySelector(".sx"),mode:document.querySelector(".mode"),musiclistbtn:document.getElementById("siquan-player-musiclist"),musicinfobtn:document.getElementById("siquan-player-musicinfo"),info:{title:document.querySelector(".info-name"),album:document.querySelector(".info-album"),singer:document.querySelector(".info-singer"),tags:document.querySelector(".info-tags"),pj:document.querySelector(".info-pj")}},i=-1,a=[];function r(r){if(a.forEach((function(e){e.abort()})),i=r,-1!=r){try{document.querySelector(".musiclist ul li.act").classList.remove("act")}catch(e){}document.querySelectorAll(".musiclist ul li")[r].classList.add("act"),SHOW_MID_IN_URL&&ENABLED_MID&&(window._p_hash_=!0,history.replaceState({},"",window.location.pathname+"#mid="+e[r].mid))}n.img.src="https://image.gumengya.cn/i/2023/10/15/652b46cf15392.png",n.title.innerText=n.album.innerText=n.info.title.innerText=n.info.album.innerText=n.info.pj.innerText=n.info.singer.innerText=n.singer.innerText="...",TAG&&(n.info.tags.innerHTML=e[r].tag.map((function(e){return'<span class="s-tag">'+e+"</span>"})).join("")),n.audio.src="",t={0:"歌词加载中"},c(),a.push(musicapi.get(-1==r?o:e[r],(function(e){e.error?alert(e.error):(n.img.src=e.img,n.title.innerText=n.info.title.innerText=e.songname,n.audio.src=e.url,n.album.innerText=n.info.album.innerText=e.album,n.singer.innerText=n.info.singer.innerText=e.artist,t=e.lrc,c())}))),-1!=r&&INFO&&ENABLED_MID&&a.push(musicapi._request(INFO_ROOT+e[r].mid+".txt",(function(e){n.info.pj.innerText=e||"暂无"})))}var o=null;function l(){var t=location.href.split("#")[1],n={};t&&(t=t.split("&")).forEach((function(e){var t=e.split("=");n[t[0]]=t[1]})),isNaN(parseInt(n.index))?"kugou"==n.type&&n.hash?(o={kugou:{hash:n.hash,album_id:n.album_id||""}},r(-1)):"netease"==n.type&&n.id?(o={netease:{id:n.id}},r(-1)):"qq"==n.type&&n.mid?(o={qq:{mid:n.mid}},r(-1)):n.mid&&ENABLED_MID?e.forEach((function(e,t){e.mid==n.mid&&r(t)})):r("first"==START_PLAY?0:Math.floor(Math.random()*e.length)):r(parseInt(n.index))}function c(){for(var e in n.lrc.innerHTML="",t){var i=document.createElement("li");i.innerText=t[e],n.lrc.append(i)}}window.onhashchange=function(){window._p_hash_?window._p_hash_=!1:e.length>0&&l()};var u=!1,s=setInterval((function(){document.querySelector(".musicbox-author")&&"陈思全"==document.querySelector(".musicbox-author").innerText.trim()||(alert("该音乐盒子侵权！"),clearInterval(s),document.write("<h1>你是否删除了.music-anthor？我劝你耗子尾汁！<h1>"))}),1e3);n.audio.addEventListener("canplay",(function(){if(u||!AUTOPLAY)try{this.play()}catch(e){}else u=!0})),n.audio.addEventListener("timeupdate",(function(){var e=n.audio.currentTime,i=n.audio.duration,a=e/i;d&&(n.range.r2.style.width=100*a+"%",n.range.r1.style.left="calc("+100*a+"% - 6px)"),n.time.cur.innerText=m(e),n.time.max.innerText=m(i);var r=-1;for(var o in t){if(e<o)break;r++}try{n.lrc.querySelector("li.act").classList.remove("act")}catch(e){}for(var l=document.querySelector(".right").getBoundingClientRect().height/2,c=n.lrc.querySelectorAll("li"),u=0;u<r;u++)l-=c[u].getBoundingClientRect().height;-1!=r&&(l-=c[r].getBoundingClientRect().height/2,n.lrc.querySelectorAll("li")[r].classList.add("act")),n.lrc.style.marginTop=l+"px"})),n.playbtn.addEventListener("click",(function(){n.container.classList.contains("playing")?n.audio.pause():n.audio.play()})),n.audio.addEventListener("play",(function(){n.container.classList.add("playing"),n.playbtn.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pause" viewBox="0 0 16 16">  <path d="M6 3.5a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5m4 0a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5"/></svg>'})),n.audio.addEventListener("pause",(function(){n.container.classList.remove("playing"),n.playbtn.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-play-fill" viewBox="0 0 16 16">  <path d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z"/></svg>'}));var d=!0;function m(e){var t=Math.floor(e/60),n=Math.floor(e%60);return isNaN(t)?"00:00":(t<10&&(t="0"+t),n<10&&(n="0"+n),t+":"+n)}n.range.r1.addEventListener("mousedown",(function(){var e;d=!1,document.onmousemove=function(t){var i=t.pageX,a=n.range.r.getBoundingClientRect().width,r=i-n.range.r.getBoundingClientRect().left;r<0&&(r=0),r>a&&(r=a),e=r/a,n.range.r2.style.width=100*e+"%",n.range.r1.style.left="calc("+100*e+"% - 6px)"},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null,d=!0,n.audio.currentTime=n.audio.duration*e}})),n.range.r1.addEventListener("touchstart",(function(){var e;d=!1,document.ontouchmove=function(t){var i=t.targetTouches[0].pageX,a=n.range.r.getBoundingClientRect().width,r=i-n.range.r.getBoundingClientRect().left;r<0&&(r=0),r>a&&(r=a),e=r/a,n.range.r2.style.width=100*e+"%",n.range.r1.style.left="calc("+100*e+"% - 6px)"},document.ontouchend=function(){document.ontouchmove=null,document.ontouchend=null,d=!0,n.audio.currentTime=n.audio.duration*e}}),{passive:!1}),n.range.r.addEventListener("click",(function(e){if(d){var t=(e.pageX-n.range.r.getBoundingClientRect().left)/n.range.r.getBoundingClientRect().width;n.audio.currentTime=n.audio.duration*t}}));var g=["order","loop","random"].indexOf(PLAY_MODE),h=['<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-repeat" viewBox="0 0 16 16"><path d="M11 5.466V4H5a4 4 0 0 0-3.584 5.777.5.5 0 1 1-.896.446A5 5 0 0 1 5 3h6V1.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192Zm3.81.086a.5.5 0 0 1 .67.225A5 5 0 0 1 11 13H5v1.466a.25.25 0 0 1-.41.192l-2.36-1.966a.25.25 0 0 1 0-.384l2.36-1.966a.25.25 0 0 1 .41.192V12h6a4 4 0 0 0 3.585-5.777.5.5 0 0 1 .225-.67Z"/></svg>','<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-repeat-1" viewBox="0 0 16 16"><path d="M11 4v1.466a.25.25 0 0 0 .41.192l2.36-1.966a.25.25 0 0 0 0-.384l-2.36-1.966a.25.25 0 0 0-.41.192V3H5a5 5 0 0 0-4.48 7.223.5.5 0 0 0 .896-.446A4 4 0 0 1 5 4zm4.48 1.777a.5.5 0 0 0-.896.446A4 4 0 0 1 11 12H5.001v-1.466a.25.25 0 0 0-.41-.192l-2.36 1.966a.25.25 0 0 0 0 .384l2.36 1.966a.25.25 0 0 0 .41-.192V13h6a5 5 0 0 0 4.48-7.223Z"/><path d="M9 5.5a.5.5 0 0 0-.854-.354l-1.75 1.75a.5.5 0 1 0 .708.708L8 6.707V10.5a.5.5 0 0 0 1 0z"/></svg>','<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-shuffle" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M0 3.5A.5.5 0 0 1 .5 3H1c2.202 0 3.827 1.24 4.874 2.418.49.552.865 1.102 1.126 1.532.26-.43.636-.98 1.126-1.532C9.173 4.24 10.798 3 13 3v1c-1.798 0-3.173 1.01-4.126 2.082A9.624 9.624 0 0 0 7.556 8a9.624 9.624 0 0 0 1.317 1.918C9.828 10.99 11.204 12 13 12v1c-2.202 0-3.827-1.24-4.874-2.418A10.595 10.595 0 0 1 7 9.05c-.26.43-.636.98-1.126 1.532C4.827 11.76 3.202 13 1 13H.5a.5.5 0 0 1 0-1H1c1.798 0 3.173-1.01 4.126-2.082A9.624 9.624 0 0 0 6.444 8a9.624 9.624 0 0 0-1.317-1.918C4.172 5.01 2.796 4 1 4H.5a.5.5 0 0 1-.5-.5"/><path d="M13 5.466V1.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192zm0 9v-3.932a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192z"/></svg>'];n.sx.innerHTML=h[g],n.nextbtn.addEventListener("click",(function(){-1!=i&&(2==g?r(Math.floor(Math.random()*e.length)):i==e.length-1?r(0):r(i+1))})),n.lastbtn.addEventListener("click",(function(){-1!=i&&r(2==g?Math.floor(Math.random()*e.length):0==i?e.length-1:i-1)})),n.audio.addEventListener("ended",(function(){1==g?(this.currentTime=0,this.play()):n.nextbtn.click()})),n.sx.addEventListener("click",(function(){2==g?g=0:g++,this.innerHTML=h[g]}));var v=['<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-moon-fill" viewBox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278"/></svg>','<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-sun-fill" viewBox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8M8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0m0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13m8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5M3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8m10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0m-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707M4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/></svg>'],f=["dark","light"],p=f.indexOf(DEFAULT_MODE);document.body.classList.add(DEFAULT_MODE),n.mode.innerHTML=v[p],n.mode.addEventListener("click",(function(){document.body.classList.remove(f[p]),p=1==p?0:1,this.innerHTML=v[p],document.body.classList.add(f[p])})),n.musiclistbtn.addEventListener("click",(function(){document.querySelector(".dialog.musiclist").classList.add("show");var e=document.querySelector(".musiclist li.act");e&&e.scrollIntoView({behavior:"smooth",block:"center"})})),n.musicinfobtn.addEventListener("click",(function(){document.querySelector(".dialog.musicinfo").classList.add("show")})),document.querySelectorAll(".dialog .close").forEach((function(e){e.addEventListener("click",(function(){this.parentElement.parentElement.parentElement.parentElement.classList.remove("show")}))}))}();
